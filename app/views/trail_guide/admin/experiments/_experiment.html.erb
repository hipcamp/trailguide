<div class="experiment row justify-content-center">
  <div class="col-sm-12 col-md-10 col-lg-8">
    <div class="row">
      <div class="col-sm-12 col-md-6 col-lg-8">
        <h4 id="<%= experiment.experiment_name %>">
          <%= link_to experiment.experiment_name.to_s.humanize.titleize, trail_guide_admin.experiments_path(anchor: experiment.experiment_name), class: "text-dark" %>
        </h4>
      </div>
      <div class="col-sm-12 col-md-6 col-lg-4 text-right">
        <% if experiment.running? %>
          <% if experiment_peekable?(experiment) %>
            <% if experiment_peeking?(experiment) %>
              <%= link_to trail_guide_admin.experiments_path(anchor: experiment.experiment_name), class: 'btn btn-sm btn-outline-primary', method: :put, data: {toggle: :tooltip}, title: "hide this experiment's metrics" do %>
                <span class="fas fa-eye-slash" />
              <% end %>
            <% else %>
              <%= link_to peek_url(experiment), class: 'btn btn-sm btn-primary', method: :put, data: {toggle: :tooltip}, title: "peek at this experiment's metrics" do %>
                <span class="fas fa-eye" />
              <% end %>
            <% end %>
          <% end %>

          <% if experiment.configuration.can_resume? %>
            <%= link_to trail_guide_admin.pause_experiment_path(experiment.experiment_name), class: 'btn btn-sm btn-warning', method: :put, data: {toggle: :tooltip}, title: 'pause this experiment - you will have the option to resume or reset' do %>
              <span class="fas fa-pause" />
            <% end %>
          <% end %>

          <%= link_to trail_guide_admin.stop_experiment_path(experiment.experiment_name), class: 'btn btn-sm btn-danger', method: :put, data: {toggle: :tooltip}, title: 'stop this experiment - once stopped you will need to reset before restarting' do %>
            <span class="fas fa-stop" />
          <% end %>

          <%= link_to trail_guide_admin.restart_experiment_path(experiment.experiment_name), class: 'btn btn-sm btn-danger',method: :put, data: {toggle: :tooltip}, title: 'restart this experiment - will reset all data and restart the experiment' do %>
            <span class="fas fa-redo" />
          <% end %>
        <% elsif experiment.paused? %>
          <% if experiment.configuration.can_resume? %>
            <%= link_to trail_guide_admin.resume_experiment_path(experiment.experiment_name), class: 'btn btn-sm btn-success',method: :put, data: {toggle: :tooltip}, title: 'resume this experiment to start bucketing users and serving variants again' do %>
              <span class="fas fa-redo" />
            <% end %>
            <%= link_to trail_guide_admin.stop_experiment_path(experiment.experiment_name), class: 'btn btn-sm btn-danger', method: :put, data: {toggle: :tooltip}, title: 'stop this experiment - once stopped you will need to reset before restarting' do %>
              <span class="fas fa-stop" />
            <% end %>
          <% end %>
          <%= link_to trail_guide_admin.restart_experiment_path(experiment.experiment_name), class: 'btn btn-sm btn-danger',method: :put, data: {toggle: :tooltip}, title: 'restart this experiment - will reset all data and restart the experiment' do %>
            <span class="fas fa-redo" />
          <% end %>
        <% elsif experiment.stopped? %>
          <%= link_to trail_guide_admin.restart_experiment_path(experiment.experiment_name), class: 'btn btn-sm btn-danger',method: :put, data: {toggle: :tooltip}, title: 'restart this experiment - will reset all data and restart the experiment' do %>
            <span class="fas fa-redo" />
          <% end %>
        <% elsif !experiment.started? %>
          <%= link_to trail_guide_admin.start_experiment_path(experiment.experiment_name), class: 'btn btn-sm btn-success',method: :put, data: {toggle: :tooltip}, title: 'start this experiment' do %>
            <span class="fas fa-play" />
          <% end %>
        <% end %>
        <%= link_to trail_guide_admin.reset_experiment_path(experiment.experiment_name), class: 'btn btn-sm btn-outline-danger',method: :put, data: {toggle: :tooltip}, title: "stop this experiment if it's running and reset all data" do %>
          <span class="fas fa-ban" />
        <% end %>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12 col-md-6 col-lg-8">
        <p><%= experiment.configuration.summary %></p>
      </div>
      <div class="col-sm-12 col-md-6 col-lg-4 text-right">
        <% if experiment.started? %>
          <small class="text-muted"><%= experiment.started_at.strftime('%b %e %Y @ %l:%M %p') %></small>
          <span class="text-muted">&mdash;</span>
          <% if experiment.stopped? %>
            <small class="text-muted"><%= experiment.stopped_at.strftime('%b %e %Y @ %l:%M %p') %></small>
          <% elsif experiment.paused? %>
            <small class="text-muted">paused</small>
          <% else %>
            <small class="text-muted">running</small>
          <% end %>
        <% else %>
          <small class="text-muted">not running</small>
        <% end %>
      </div>
    </div>

    <table class="table table-hover">
      <thead class="thead-light">
        <tr>
          <th scope="col">&nbsp;</th>

          <th scope="col">Participants</th>

          <% if experiment.goals.empty? %>
            <th scope="col">Converted</th>
          <% else %>
            <% experiment.goals.each do |goal| %>
              <th scope="col"><%= goal.to_s.humanize.titleize %></th>
            <% end %>
          <% end %>

          <th>&nbsp;</th>
        </tr>
      </thead>

      <tbody>
        <% experiment.variants.each do |variant| %>
          <tr>
            <th scope="row">
              <% if experiment.configuration.preview_url? %>
                <%= link_to variant.name.to_s.humanize.titleize, preview_url(variant), target: :blank, class: "text-dark" %>
              <% else %>
                <%= variant.name.to_s.humanize.titleize %>
              <% end %>

              <% if experiment.running? && !experiment.winner? && participant.variant(experiment) == variant %>
                <span class="fas fa-user text-muted" data-toggle="tooltip" title="you are currently in this cohort"></span>
              <% end %>
              <% if experiment.winner? && variant == experiment.winner %>
                <span class="fas fa-star text-primary" data-toggle="tooltip" title="this variant has been promoted as the winner of the experiment"></span>
              <% end %>
              <% if variant.control? %>
                <span class="fas fa-cog text-muted" data-toggle="tooltip" title="this variant is the control group for this experiment"></span>
              <% end %>
            </th>

            <td><%= experiment_metric experiment, variant.participants %></td>

            <% if experiment.goals.empty? %>
              <td><%= experiment_metric experiment, variant.converted %></td>
            <% else %>
              <% experiment.goals.each do |goal| %>
                <td><%= experiment_metric experiment, variant.converted(goal) %></td>
              <% end %>
            <% end %>

            <td class="text-right">
              <% if experiment.running? && !experiment.winner? %>
                <% if participant.variant(experiment) == variant %>
                  <%= link_to trail_guide_admin.leave_experiment_path(experiment.experiment_name), class: "btn btn-sm btn-outline-secondary", method: :put, data: {toggle: :tooltip}, title: 'leave this cohort' do %>
                    <span class="fas fa-sign-out-alt" />
                  <% end %>
                <% else %>
                  <%= link_to trail_guide_admin.join_experiment_path(experiment.experiment_name, variant.name), class: "btn btn-sm btn-secondary", method: :put, data: {toggle: :tooltip}, title: 'join this cohort' do %>
                    <span class="fas fa-sign-in-alt" />
                  <% end %>
                <% end %>
              <% end %>

              <% if !experiment.winner? || variant != experiment.winner %>
                <%= link_to trail_guide_admin.winner_experiment_path(experiment.experiment_name, variant.name), class: "btn btn-sm btn-#{experiment.winner? ? "outline-" : ""}primary", method: :put, data: {toggle: :tooltip}, title: 'rollout this variant as the winner for this experiment' do %>
                  <span class="fas fa-star" />
                <% end %>
              <% elsif experiment.winner? && variant == experiment.winner %>
                <%= link_to trail_guide_admin.clear_experiment_path(experiment.experiment_name), class: "btn btn-sm btn-warning", method: :put, data: {toggle: :tooltip}, title: 'remove this variant as the selected winner' do %>
                  <span class="fas fa-window-close" />
                <% end %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>

      <tfoot class="thead-light">
        <tr>
          <th scope="row">&nbsp;</th>
          <th>
            <span><%= number_with_delimiter experiment.participants %></span>
            <% if experiment.configuration.target_sample_size %>
              <span class="text-muted">/ <%= number_with_delimiter experiment.configuration.target_sample_size %></span>
            <% end %>
          </th>
          <% if experiment.goals.empty? %>
            <th><%= experiment_metric experiment, experiment.converted %></th>
          <% else %>
            <% experiment.goals.each do |goal| %>
              <th><%= experiment_metric experiment, experiment.converted(goal) %></th>
            <% end %>
          <% end %>
          <th>&nbsp;</th>
        </tr>
      </tfoot>
    </table>
  </div>
</div>
