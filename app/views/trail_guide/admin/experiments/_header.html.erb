<div class="row">
  <div class="col-12">
    <% if experiment <= TrailGuide::CombinedExperiment %>
      <div class="alert alert-dark">
        <h5>
          <span class="fas fa-object-group"></span>
          Combined Experiment
        </h5>
        <p>This experiment is part of a combined experiment and can only be managed via it's parent. Use the button below to view the parent experiment.</p>
        <div class="text-right">
          <%= link_to experiment.parent.experiment_name.to_s.humanize.titleize, trail_guide_admin.experiment_path(experiment.parent.experiment_name), class: 'btn btn-dark' %>
        </div>
      </div>
    <% end %>

    <div class="alert alert-<%= experiment_color(experiment) %>">
      <h5 class="text-<%= experiment_color(experiment) %>">
        <span class="fas <%= experiment_icon(experiment) %> text-<%= experiment_color(experiment) %>"></span>
        &nbsp;
        <% if experiment.winner? %>
          Winner Promoted
        <% elsif experiment.started? %>
          <% if experiment.stopped? %>
            Stopped
          <% elsif experiment.paused? %>
            Paused
          <% else %>
            Running
          <% end %>
        <% elsif experiment.scheduled? %>
          Scheduled
        <% else %>
          Not Started
        <% end %>
      </h5>

      <p>
        <% if experiment.winner? %>
          A winning variant has been selected for this experiment and will be returned to all participants.
          <% if experiment.started? && experiment.configuration.track_winner_conversions %>
            This experiment is configured with <code>track_winner_conversions</code>, so as long as your experiment is still running you will be able to continue tracking conversions against the winner. You can stop your experiment to stop tracking conversions.
          <% end %>
        <% elsif experiment.started? %>
          <% if experiment.stopped? %>
            This experiment has been stopped. The control variant will be returned to all participants until it is restarted or a winner is selected.
          <% elsif experiment.paused? %>
            This experiment has been paused. The control variant will be returned to all participants until it is resumed, restarted or a winner is selected.
          <% else %>
            This experiment is currently running. Participants will be enrolled and served a variant based on the configured alrogithm.
          <% end %>
        <% elsif experiment.scheduled? %>
          This experiment has been scheduled to start on <strong><%= experiment.started_at.strftime(TrailGuide::Admin::DISPLAY_DATE_FORMAT) %></strong>
          <% if experiment.stopped_at.present? %>
            and stop on <strong><%= experiment.stopped_at.strftime(TrailGuide::Admin::DISPLAY_DATE_FORMAT) %></strong>
          <% end %>
        <% else %>
          This experiment has not been started. Use the controls to start or schedule your experiment.
        <% end %>
      </p>
    </div>

    <% if experiment_peekable?(experiment) %>
      <% if experiment_peeking?(experiment) %>
        <div class="alert alert-primary">
          <h5>
            <span class="fas fa-eye-slash"></span>
            Peeking at Results
          </h5>
          <p>You are currently peeking at this experiment's results. Use the button below to stop peeking.</p>
          <div class="text-right">
            <%= link_to trail_guide_admin.experiment_path(experiment.experiment_name), class: 'btn btn-outline-primary', method: :put do %>
              <span class="fas fa-eye-slash"></span>
              Stop Peeking
            <% end %>
          </div>
        </div>
      <% else %>
        <div class="alert alert-primary">
          <h5>
            <span class="fas fa-eye"></span>
            Target Sample Size
          </h5>
          <p>This experiment has been configured with a <code>target_sample_size</code> of <code><%= experiment.configuration.target_sample_size %></code>, which prevents variant metrics from being displayed until the experiment has ended. You may peek at the current results by clicking the button below.</p>
          <div class="text-right">
            <%= link_to peek_url(experiment), class: 'btn btn-primary', method: :put do %>
              <span class="fas fa-eye"></span>
              Peek
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
</div>

<div class="row align-items-center">
  <div class="col-8 col-lg-10">
    <h1 id="<%= experiment.experiment_name %>">
      <%= experiment.experiment_name.to_s.humanize.titleize %>
    </h1>
  </div>

  <div class="col-4 col-lg-2 text-right">
    <% unless experiment <= TrailGuide::CombinedExperiment %>
      <div class="btn-group">
        <%= render partial: 'btn_schedule', locals: { experiment: experiment } %>
        <%= render partial: 'btn_start', locals: { experiment: experiment } %>
        <%= render partial: 'btn_peek', locals: { experiment: experiment } %>
        <%= render partial: 'btn_pause', locals: { experiment: experiment } %>
        <%= render partial: 'btn_resume', locals: { experiment: experiment } %>
        <%= render partial: 'btn_stop', locals: { experiment: experiment } %>
        <%= render partial: 'btn_restart', locals: { experiment: experiment } %>
        <%= render partial: 'btn_reset', locals: { experiment: experiment } %>
      </div>
    <% end %>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <h5>
      <% if experiment.started? %>
        <% if experiment.stopped? %>
          <span class="text-muted">
            <%= experiment.started_at.strftime('%b %e %Y @ %l:%M %p') %>
          </span>
          <span class="text-muted">&mdash;</span>
          <span class="text-muted"><%= experiment.stopped_at.strftime('%b %e %Y @ %l:%M %p') %></span>
        <% elsif experiment.paused? %>
          <span class="text-muted">
            <%= experiment.paused_at.strftime('%b %e %Y @ %l:%M %p') %>
          </span>
        <% else %>
          <span class="text-muted">
            <%= experiment.started_at.strftime('%b %e %Y @ %l:%M %p') %>
          </span>
        <% end %>
      <% elsif experiment.scheduled? %>
        <span class="text-muted">
          <%= experiment.started_at.strftime('%b %e %Y @ %l:%M %p') %>
        </span>
      <% end %>
    </h5>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <p><%= experiment.configuration.summary %></p>
  </div>
</div>
